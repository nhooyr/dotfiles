mkdir -p ~/.local/share/zsh

# Lines configured by zsh-newuser-install
HISTFILE=~/.local/share/zsh/history
HISTSIZE=100000
SAVEHIST=100000
setopt appendhistory autocd extendedglob
# End of lines configured by zsh-newuser-install

# Has to be set before compinit.
fpath=(/usr/local/share/zsh-completions $fpath)

# The following lines were added by compinstall
zstyle ":completion:*" list-colors ""
zstyle ":completion:*" matcher-list "" "+m:{[:lower:]}={[:upper:]}" "+r:|[._-]=** r:|=**" "+l:|=* r:|=*"
zstyle ":completion:*" menu select
zstyle :compinstall filename "/Users/nhooyr/.zshrc"

autoload -Uz compinit
# See https://github.com/zsh-users/zsh-completions/issues/433#issuecomment-346395881 for -i.
# Allows sharing compinit with root.
compinit -i
# End of lines added by compinstall

# Binds Shift + Tab reverse completion.
# https://stackoverflow.com/a/842370/4283659
bindkey "^[[Z" reverse-menu-complete

# Otherwise delete by word deletes over slashes.
# https://stackoverflow.com/questions/444951/zsh-stop-backward-kill-word-on-directory-delimiter
autoload -U select-word-style
select-word-style bash

source_if_exists() {
	if [[ -f $1 ]]; then
	  source "$@"	
	fi
}

# Bash"s time format is much better.
# ZSH"s default is a single line.
# https://superuser.com/a/71890
TIMEFMT="
real    %*E
user    %*U
sys     %*S"

tabs -2

# Disables control flow so that Ctrl + S works
# for forward history search.
# https://superuser.com/a/1067896
stty -ixon

# Homebrew takes forever to update.
export HOMEBREW_NO_AUTO_UPDATE=1

export GOPATH=~/.local/share/gopath

# Disables the beep on ambigous completion.
unsetopt LIST_BEEP

setopt HIST_REDUCE_BLANKS
setopt EXTENDED_HISTORY
setopt HIST_IGNORE_ALL_DUPS
setopt HIST_SAVE_NO_DUPS
setopt INC_APPEND_HISTORY

# Fish style history search.
# https://unix.stackexchange.com/a/97844
bindkey "^p" history-beginning-search-backward
bindkey "^n" history-beginning-search-forward

ZSH_AUTOSUGGEST_USE_ASYNC=1
source_if_exists /usr/local/share/zsh-autosuggestions/zsh-autosuggestions.zsh
bindkey "^v" autosuggest-execute

setopt AUTO_PUSHD
setopt PUSHD_SILENT

alias ls="ls -GF"
alias l="ls -lh"
alias ll="ls -lha"
alias up="cd .."

source_if_exists /usr/local/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# Always reloads command list before completing.
# https://bbs.archlinux.org/viewtopic.php?id=175388
# http://www.zsh.org/mla/users/2006/msg00181.html
zstyle ":completion:*" rehash true

export MANPAGER="nvim +Man!"
export MANWIDTH=80

source ~/src/nhooyr/dotfiles/zsh/prompt.zsh
