#!/usr/bin/env bash

set -euo pipefail

unlink=${1+1}
ln() {
  if [[ $unlink ]]; then
    rm "$2"
    return
  elif [[ -L $2 ]]; then
    echo "already linked"
    return
  elif [[ -e $2 ]]; then
    echo "$1 exists and is not a symlink"
    return
  fi
  command ln -s "${PWD}/$1" "$2"
}

ln git ~/.config/git
ln nvim ~/.config/nvim
ln npmrc ~/.npmrc
ln fish ~/.config/fish
ln mutagen.yml ~/.mutagen.yml
ln fdignore ~/.fdignore

if [[ $OSTYPE == darwin* ]]; then
  ln sublimeText3 "${HOME}/Library/Application Support/Sublime Text 3/Packages/User"
  ln launchAgents/set_defaults_variables.plist ~/Library/LaunchAgents/set_defaults_variables.plist
  ln gpg-agent.conf ~/.gnupg/gpg-agent.conf
fi

if [[ "$OSTYPE" == linux-gnu ]]; then
  sudo cp -f green.timer /etc/systemd/system/green.timer
  sudo cp -f green.service /etc/systemd/system/green.service
fi

echo "looks good captain"
