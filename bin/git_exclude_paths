#!/bin/sh
set -eu

main() {
  git_dir="$1"
  git -C "$git_dir" ls-files --exclude-standard -io --directory | sed "s#^#$git_dir/#"

  if [ ! -f "$git_dir/.gitmodules" ]; then
    return
  fi

  local submodules="$(git config --file "$git_dir/.gitmodules" --get-regexp "path" | awk '{ print $2 }' | sed "s#^#$git_dir/#")"
  IFS=\n for sub in "${submodules[@]}"; do
    if [[ "$sub" == "$local_path"* ]]; then
      git_exclude_paths "$sub"
    fi
  done
}

main "$@"
